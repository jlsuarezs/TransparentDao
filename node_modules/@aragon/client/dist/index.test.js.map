{"version":3,"sources":["../src/index.test.js"],"names":["Index","proxyquire","noCallThru","load","test","afterEach","always","sinon","restore","t","plan","observable","Observable","of","id","result","instanceStub","rpc","sendAndObserveResponse","stub","returns","AppProxyHandler","get","subscribe","value","is","getCall","args","deepEqual","networkDetails","type","networkFn","AppProxy","prototype","network","jsonrpc","sendAndObserveResponses","call","truthy","accountsFn","accounts","identifyFn","identify","send","eventsFn","events","falsy","externalFn","external","observableA","name","observableB","jsonInterfaceStub","constant","grantPermission","stateFn","state","counter","storeFn","store","from","actionHistory","event","payload","cache","returnsArg","action","push","callFn","contextFn","context","params","method","requests","true","describeScriptFn","describeScript","web3EthFn","web3Eth"],"mappings":"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","sourcesContent":["import test from 'ava'\nimport sinon from 'sinon'\nimport proxyquire from 'proxyquire'\nimport { Observable } from 'rxjs/Rx'\n\nconst Index = proxyquire.noCallThru().load('./index', {\n  '@aragon/messenger': {}\n})\n\ntest.afterEach.always(() => {\n  sinon.restore()\n})\n\ntest('should send intent when the method does not exist in target', t => {\n  t.plan(3)\n  // arrange\n  const observable = Observable.of({\n    id: 'uuid1',\n    result: 10\n  })\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponse: sinon.stub()\n        .returns(observable)\n    }\n  }\n  // act\n  const result = Index.AppProxyHandler.get(instanceStub, 'add')(5)\n  // assert\n  result.subscribe(value => {\n    t.is(value, 10)\n  })\n  t.is(instanceStub.rpc.sendAndObserveResponse.getCall(0).args[0], 'intent')\n  t.deepEqual(instanceStub.rpc.sendAndObserveResponse.getCall(0).args[1], ['add', 5])\n})\n\ntest('should return the network details as an observable', t => {\n  t.plan(3)\n  // arrange\n  const networkDetails = {\n    id: 4,\n    type: 'rinkeby'\n  }\n  const networkFn = Index.AppProxy.prototype.network\n  const observable = Observable.of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: networkDetails\n  })\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponses: sinon.stub()\n        .returns(observable)\n    }\n  }\n  // act\n  const result = networkFn.call(instanceStub)\n  // assert\n  // the call to sendAndObserveResponse is made before we subscribe\n  t.truthy(instanceStub.rpc.sendAndObserveResponses.getCall(0))\n  result.subscribe(value => {\n    t.deepEqual(value, networkDetails)\n  })\n  t.is(instanceStub.rpc.sendAndObserveResponses.getCall(0).args[0], 'network')\n})\n\ntest('should return the accounts as an observable', t => {\n  t.plan(3)\n  // arrange\n  const accountsFn = Index.AppProxy.prototype.accounts\n  const observable = Observable.of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: ['accountX', 'accountY', 'accountZ']\n  })\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponses: sinon.stub()\n        .returns(observable)\n    }\n  }\n  // act\n  const result = accountsFn.call(instanceStub)\n  // assert\n  // the call to sendAndObserveResponse is made before we subscribe\n  t.truthy(instanceStub.rpc.sendAndObserveResponses.getCall(0))\n  result.subscribe(value => {\n    t.deepEqual(value, ['accountX', 'accountY', 'accountZ'])\n  })\n  t.is(instanceStub.rpc.sendAndObserveResponses.getCall(0).args[0], 'accounts')\n})\n\ntest('should send an identify request', t => {\n  t.plan(2)\n  // arrange\n  const identifyFn = Index.AppProxy.prototype.identify\n  const instanceStub = {\n    rpc: {\n      send: sinon.stub()\n    }\n  }\n  // act\n  identifyFn.call(instanceStub, 'ANT')\n  // assert\n  t.is(instanceStub.rpc.send.getCall(0).args[0], 'identify')\n  t.deepEqual(instanceStub.rpc.send.getCall(0).args[1], ['ANT'])\n})\n\ntest('should return the events observable', t => {\n  t.plan(3)\n  // arrange\n  const eventsFn = Index.AppProxy.prototype.events\n  const observable = Observable.of({\n    id: 'uuid1',\n    result: ['eventA', 'eventB']\n  })\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponses: sinon.stub()\n        .returns(observable)\n    }\n  }\n  // act\n  const result = eventsFn.call(instanceStub)\n  // assert\n  // the call to sendAndObserveResponse should be defered until we subscribe\n  t.falsy(instanceStub.rpc.sendAndObserveResponses.getCall(0))\n  result.subscribe(value => {\n    t.deepEqual(value, ['eventA', 'eventB'])\n  })\n  t.is(instanceStub.rpc.sendAndObserveResponses.getCall(0).args[0], 'events')\n})\n\ntest('should return an handle for an external contract events', t => {\n  t.plan(7)\n  // arrange\n  const externalFn = Index.AppProxy.prototype.external\n  const observableA = Observable.of({\n    id: 'uuid1',\n    result: { name: 'eventA', value: 3000 }\n  })\n  const observableB = Observable.of({\n    id: 'uuid4',\n    result: 'bob was granted permission for the counter app'\n  })\n  const jsonInterfaceStub = [\n    { type: 'event', name: 'SetPermission' },\n    { type: 'function', name: 'grantPermission', constant: true }\n  ]\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponses: sinon.stub()\n        .returns(observableA),\n\n      sendAndObserveResponse: sinon.stub()\n        .returns(observableB)\n    }\n  }\n  // act\n  const result = externalFn.call(instanceStub, '0xextContract', jsonInterfaceStub)\n  // assert\n  // the call to sendAndObserveResponse should be defered until we subscribe\n  t.falsy(instanceStub.rpc.sendAndObserveResponses.getCall(0))\n  // events from block 2\n  result.events(2).subscribe(value => {\n    t.deepEqual(value, { name: 'eventA', value: 3000 })\n\n    t.is(instanceStub.rpc.sendAndObserveResponses.getCall(0).args[0], 'external_events')\n    t.deepEqual(\n      instanceStub.rpc.sendAndObserveResponses.getCall(0).args[1],\n      ['0xextContract', [jsonInterfaceStub[0]], 2]\n    )\n  })\n  result.grantPermission('0xbob', '0xcounter').subscribe(value => {\n    t.is(value, 'bob was granted permission for the counter app')\n\n    t.is(instanceStub.rpc.sendAndObserveResponse.getCall(0).args[0], 'external_call')\n    t.deepEqual(\n      instanceStub.rpc.sendAndObserveResponse.getCall(0).args[1],\n      ['0xextContract', jsonInterfaceStub[1], '0xbob', '0xcounter']\n    )\n  })\n})\n\ntest('should return the state from cache', t => {\n  t.plan(3)\n  // arrange\n  const stateFn = Index.AppProxy.prototype.state\n  const observable = Observable.of({\n    id: 'uuid1',\n    result: { counter: 5 }\n  })\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponses: sinon.stub()\n        .returns(observable)\n    }\n  }\n  // act\n  const result = stateFn.call(instanceStub)\n  // assert\n  t.is(instanceStub.rpc.sendAndObserveResponses.getCall(0).args[0], 'cache')\n  t.deepEqual(instanceStub.rpc.sendAndObserveResponses.getCall(0).args[1], ['get', 'state'])\n  result.subscribe(value => {\n    t.deepEqual(value, { counter: 5 })\n  })\n})\n\ntest('should create a store/state reducer', async t => {\n  t.plan(2)\n  // arrange\n  const storeFn = Index.AppProxy.prototype.store\n  const observableA = Observable.from([{\n    actionHistory: [\n      { event: 'Add', payload: 5 }\n    ],\n    counter: 5\n  }, {\n    // this will be ignored, but recalculated correctly because we still have the event\n    actionHistory: [\n      { event: 'Add', payload: 5 },\n      { event: 'Add', payload: 2 }\n    ],\n    counter: 7\n  }])\n  const observableB = Observable.from([\n    { event: 'Add', payload: 2 },\n    { event: 'Add', payload: 10 }\n  ])\n  const instanceStub = {\n    state: () => observableA,\n    events: () => observableB,\n    cache: sinon.stub().returnsArg(1) // should return 2nd argument\n  }\n  const reducer = (state, action) => {\n    if (state === null) state = { actionHistory: [], counter: 0 }\n\n    switch (action.event) {\n      case 'Add':\n        state.actionHistory.push(action)\n        state.counter += action.payload\n        return state\n      case 'Subtract':\n        state.actionHistory.push(action)\n        state.counter -= action.payload\n        return state\n    }\n    return state\n  }\n  // act\n  const result = storeFn.call(instanceStub, reducer)\n  // assert\n  result.subscribe(value => {\n    if (value.counter === 7) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 5 },\n        { event: 'Add', payload: 2 }\n      ])\n    }\n    if (value.counter === 17) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 5 },\n        { event: 'Add', payload: 2 },\n        { event: 'Add', payload: 10 }\n      ])\n    }\n  })\n})\n\ntest('should perform a call to the contract and observe the response', t => {\n  t.plan(3)\n  // arrange\n  const callFn = Index.AppProxy.prototype.call\n  const observable = Observable.of({\n    id: 'uuid1',\n    result: 'success'\n  })\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponse: sinon.stub()\n        .returns(observable)\n    }\n  }\n  // act\n  const result = callFn.call(instanceStub, 'transferEth', 10)\n  // assert\n  t.is(instanceStub.rpc.sendAndObserveResponse.getCall(0).args[0], 'call')\n  t.deepEqual(instanceStub.rpc.sendAndObserveResponse.getCall(0).args[1], ['transferEth', 10])\n  result.subscribe(value => {\n    t.deepEqual(value, 'success')\n  })\n})\n\ntest('should listen for app contexts sent from the wrapper and return the first param', t => {\n  t.plan(2)\n  // arrange\n  const contextFn = Index.AppProxy.prototype.context\n  const observable = Observable.from([{\n    id: 'uuid0',\n    // this will get filtered out\n    params: ['x', 'y']\n  }, {\n    id: 'uuid1',\n    method: 'context',\n    params: ['first', 'second']\n  }, {\n    id: 'uuid4',\n    method: 'context',\n    params: [1, 2]\n  }])\n  const instanceStub = {\n    rpc: {\n      requests: sinon.stub()\n        .returns(observable)\n    }\n  }\n  // act\n  const result = contextFn.call(instanceStub)\n  // assert\n  result.subscribe(value => {\n    t.true(value === 'first' || value === 1)\n  })\n})\n\ntest('should send a describeScript request and observe the response', t => {\n  t.plan(3)\n  // arrange\n  const describeScriptFn = Index.AppProxy.prototype.describeScript\n  const observable = Observable.of({\n    id: 'uuid1',\n    result: 'script executed'\n  })\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponse: sinon.stub()\n        .returns(observable)\n    }\n  }\n  // act\n  const result = describeScriptFn.call(instanceStub, 'goto fail')\n  // assert\n  t.is(instanceStub.rpc.sendAndObserveResponse.getCall(0).args[0], 'describe_script')\n  t.deepEqual(instanceStub.rpc.sendAndObserveResponse.getCall(0).args[1], ['goto fail'])\n  result.subscribe(value => {\n    t.deepEqual(value, 'script executed')\n  })\n})\n\ntest('should send a web3Eth function request and observe the response', t => {\n  t.plan(3)\n  // arrange\n  const web3EthFn = Index.AppProxy.prototype.web3Eth\n  const observable = Observable.of({\n    id: 'uuid1',\n    result: ['accountA', 'accountB']\n  })\n  const instanceStub = {\n    rpc: {\n      sendAndObserveResponse: sinon.stub()\n        .returns(observable)\n    }\n  }\n  // act\n  const result = web3EthFn.call(instanceStub, 'getAccounts', 5)\n  // assert\n  t.is(instanceStub.rpc.sendAndObserveResponse.getCall(0).args[0], 'web3_eth')\n  t.deepEqual(instanceStub.rpc.sendAndObserveResponse.getCall(0).args[1], ['getAccounts', 5])\n  result.subscribe(value => {\n    t.deepEqual(value, ['accountA', 'accountB'])\n  })\n})\n"],"file":"index.test.js"}