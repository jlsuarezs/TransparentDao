"use strict";

var path = require('path');

var fs = require('fs-extra');

var _require = require('../util'),
    findProjectRoot = _require.findProjectRoot;

module.exports = function moduleMiddleware(argv) {
  var runsInCwd = argv['_'] === 'init';

  if (!runsInCwd) {
    try {
      var modulePath = path.resolve(findProjectRoot(), 'arapp.json');
      var arapp = fs.readJsonSync(modulePath); // hack: we need to access the module in downstream middleware, but
      // yargs does not update the `argv` param until all middleware have
      // ran, so we directly mutate the `argv` param
      // https://github.com/yargs/yargs/issues/1232

      argv.module = arapp;
    } catch (err) {// argv.reporter.debug(err)
    }
  }

  return {};
};